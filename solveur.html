<!DOCTYPE html>
<html>
<head>
    
</head>

<body>
     <form id = "form">
        <label><input type="text" id = "mot1" /> MOT1</label><br />
        <label><input type="text" id = "mot2" /> + MOT2</label><br />
        <label><input type="text" id = "mot3" /> = MOT3</label><br />
        <br/> <br/>
       
        <input type = "submit" id = "solve" name = "solve"/>
    

     </form>
   
     <br/><br/>
     <label><input type="text" id = "val1" /></label><br />
     <label>+ <input type="text" id = "val2" /></label><br />
     <label>= <input type="text" id = "val3" /></label><br />


 

       <script  type = "module" src = 'finitedomain-master/finitedomain-master/src/solver.js'>

         import {solver} from 'finitedomain-master/finitedomain-master/src';
         var submit = document.getElementById('solve');
         var form = document.getElementById('form');
         
         //supprime les doublons dans une chaîne de caractères 
         function removeDoubles(string) {
            var mapping = {};
            var newString = '';

            for (var i = 0; i < string.length; i++) {
                  if (!(string[i] in mapping)) {
                      newString += string[i];
                      mapping[string[i]] = true;
                    }
              }
              return newString;
            }


         form.addEventListener('submit', function() {
            var m1 = document.getElementById('mot1').value;
            var m2 = document.getElementById('mot2').value;
            var m3 = document.getElementById('mot3').value;
         
         //On parcourt chaque mot du puzzle de droite à gauche (sens de résolution d'une addition posée), et on considère une lettre pour
         //chaque mot
         //    SEND
         //+   MORE
         //=  MONEY
         //faire les 3 boucles en une boucle. a chaque itération : retenu précédente + l1 + l2... (4 contraintes)
         //récupérer la taille du 3e et faire un parcourt jusqu'à la taille du 3eme 
         let solver = new Solver(); 
         for (var i = m1.length - 1 ; i>=0 ; i --) {
            for (var j = m2.length - 1 ; j >= 0 ; j-- ) {
               for (var k = m3.length - 1 ; k >= 0 ; k-- ) {

                  var lettre1 = m1.charAt(i);
                  var lettre2 = m2.charAt(j);
                  var lettre3 = m3.charAt(k);

                  //On définit les contraintes : ce sont des propagateurs qui réduisent l'espace de solutions à chaque itération
                  
                  var totalLettres = (m1.concat(m2)).concat(m3); //On concatène les 3 mots en une chaîne de caractères
                  var chaine = removeDoubles(totalLettres); // On enlève les doublons (ex : SENDMOREMONEY)
                  
                  solver.distinct(chaine); //Toutes les lettres doivent avoir une valeur distincte
                  solver.nequ(m3.charAt(0), 0); //la première lettre du 3ème mot est différente de 0 (ex : M!= 0)
                  solver.decl(lettre1,[0,9]); //lettre 1 est un chiffre compris entre 0 et 9
                  solver.decl(lettre2,[0,9]);
                  solver.decl(lettre3,[0,9]);
                  solver.plus(lettre1, lettre2, lettre3); //Retenue précedente + lettre1 + lettre2 = lettre3 (ex : D + E = Y, puis N + R = E, etc..)
                  
               }
            }
         }

         //On affiche les digit correspondants à chaque lettre 
         for (var i = 0; i< totalLettres.length; i ++) {
            //on appelle la méthode solve() du solveur pour résoudre le puzzle
            solver.solve();
            console.log(solver.solutions);
         }
      })

    </script>

</body>

</html>