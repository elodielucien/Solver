<!DOCTYPE html>
<html>
<head>
    
</head>

<body>

        <form id = "form">
                <label><input type="text" id = "mot1" /> Mot1</label><br />
                <label><input type="text" id = "mot2" /> Mot2</label><br />
                <label><input type="text" id = "mot3" /> Mot3</label><br />
        </form>
        <button id="button" onclick="solve()">Solve</button>

        <br/>
        <br/>

        <label id="res">Solution</label>
        <p id="solution">

        </p>


        <script type = "module">
            import {Solver} from "http://localhost:3000/finitedomain/finitedomain-master/src/solver.js"


            //détermine la longueur du plus long mot
            function getLongestWord(mot1 , mot2, mot3) {
                var longestLength = mot1.length;
                var compter = 0;
                
                for (var i = 0 ; i < mot2.length ; i++) {  
                compter ++; 
                }

                if(compter >= longestLength) { //on compare longestLength avec la longueur du 2e mot
                longestLength = compter;
                }

                compter = 0; //on remet le compter à 0

                for (var i = 0 ; i < mot3.length ; i++) {  
                compter ++; 
                }

                if(compter >= longestLength) { //on compare longestLength avec la longueur du 3e mot
                longestLength = compter;
                }

                return longestLength;

            }


            function solve() {
                    let solver = new Solver();
                    // on va séparer les lettres de chaque mot en les mettant dans une liste (split)
                    let m1 = document.getElementById('mot1').value.split('')
                    let m2 = document.getElementById('mot2').value.split('')
                    let m3 = document.getElementById('mot3').value.split('')
                    
                     //Range chaque mot dans un tableau de longueur le plus long mot en partant de la droite
                     //Remplace les cases vides par une variable "VIDE"= 0
                     //ex : [_,S,E,N,D]
                     //     [_,M,O,R,E]
                     //     [M,O,N,E,Y]

                     //=> [VIDE,S,E,N,D]
                     //   [VIDE,M,O,R,E]
                     //   [M   ,O,N,E,Y]

                    let tabM1 = new Array(getLongestWord(m1,m2,m3))
                    let tabM2 = new Array(getLongestWord(m1,m2,m3))
                    let tabM3 = new Array(getLongestWord(m1,m2,m3))             
           
                    for (let i = m1.length-1; i>=0 ; i--) {
                        let ecart = getLongestWord(m1,m2,m3) - m1.length
                        tabM1[i+ecart] = m1[i]
                    }

                    for (let i = m2.length-1; i>=0 ; i--) {
                        let ecart = getLongestWord(m1,m2,m3) - m2.length
                        tabM2[i+ecart] = m2[i]
                    }

                    for (let i = m3.length-1; i>=0 ; i--) {
                        let ecart = getLongestWord(m1,m2,m3) - m3.length
                        tabM3[i+ecart] = m3[i]
                    }

                    for(let i = 0; i< tabM1.length ; i++) {
                        if (tabM1[i] == undefined) {
                            tabM1[i] = "VIDE1"+i
                            solver.decl(tabM1[i], 0)
                        }

                        if (tabM2[i] == undefined) {
                            tabM2[i] = "VIDE2"+i
                            solver.decl(tabM2[i], 0)
                        }

                        if (tabM3[i] == undefined) {
                            tabM3[i] = "VIDE3"+i
                            solver.decl(tabM3[i], 0)
                        }
                    }

                    // déclaration des retenues, sommes et produits que l'on va utiliser dans la déclaration des contraintes
                    let retenues = new Array(getLongestWord(m1, m2, m3))
                    let sommes = new Array(getLongestWord(m1, m2, m3))
                    let produits = new Array(getLongestWord(m1, m2, m3))

                    //on remplit ces 3 tableaux obtenus par des lettres (qui ne feront pas partie des lettres du puzzle) qui seront 
                    //utilisées dans les contraintes solveur

                    for (let i = 0; i < retenues.length; i++) {
                        retenues[i] = "R" + i
                        sommes[i] = "S" + i
                        produits[i] = "P" + i
                        solver.decl(retenues[i], [0, 1])
                        solver.decl(produits[i], [0, 10])
                        solver.decl(sommes[i], [0, 18])
                    }


                    // déclaration des lettres
                    // d'abord on créé une liste à lettres uniques
                    let uniquesLettres = [...new Set(m1.concat(m2).concat(m3))]
                    for (let lettre of uniquesLettres) {
                        if (lettre == m1[0] || lettre == m2[0] ||lettre == m3[0]){ 
                            solver.decl(lettre, [1, 9]) //la première lettre de chaque mot n'est pas 0
                        }
                        else {solver.decl(lettre, [0, 9])}
                    }
                    //chaque lettre correspond à un chiffre distinct
                    solver.distinct(uniquesLettres)

                    for (let i = retenues.length - 1; i >= 0; i--) {
                        //On définit un tableau de variables contenant retenues[i], m1[i], m2[i], qui sera utilisé dans la contrainte finale
                        let tabVariables = new Array(retenues[i], tabM1[i], tabM2[i])

                        //on gère le cas i=0 (=> retenues[i-1] = undefined)
                        if(retenues[i-1] == undefined) {
                            solver.sum(tabVariables,tabM3[i])
                            break
                        }
                        else { 
                              //on définit produit[i] = 10 * retenues[i-1]
                              solver.mul(10, retenues[i - 1], produits[i])
                              //on définit sommes[i] = m3[i] + produits[i]
                              solver.plus(tabM3[i], produits[i], sommes[i])
                              //on définit la contrainte en entier : retenues[i] + m1[i] + m2[i] = sommes[i]
                              solver.sum(tabVariables, sommes[i]) //la somme de toutes les variables de tabVariables est égale à sommes[i]
                        }  
                        

                    }

                    //résolution
                    solver.solve();

                    //affichage du résultat
                    for(let letter of uniquesLettres) {
                        console.log(letter + " : " +solver.solutions[1][letter])
                    }

                }


                window.solve = solve;

        </script>

</body>

</html>