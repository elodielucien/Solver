<!DOCTYPE html>
<html>
<head>
    
</head>

<body>
     <form id = "form">
        <label><input type="text" id = "mot1" /> MOT1</label><br />
        <label><input type="text" id = "mot2" /> + MOT2</label><br />
        <label><input type="text" id = "mot3" /> = MOT3</label><br />
        <br/> <br/>
       
        <input type = "submit" id = "solve" name = "solve"/>
    

     </form>
   
     <br/><br/>
     <label><input type="text" id = "val1" /></label><br />
     <label>+ <input type="text" id = "val2" /></label><br />
     <label>= <input type="text" id = "val3" /></label><br />


 

       
       <script type="module">
         import {Solver} from 'http://localhost:3000/finitedomain/finitedomain-master/src/solver.js';

         var submit = document.getElementById('solve');
         var form = document.getElementById('form');
         

         //détermine la longueur du plus long mot
         function getLongestWord(mot1 , mot2, mot3) {
            var longestLength = mot1.length;
            var compter = 0;
               
            for (var i = 0 ; i < mot2.length ; i++) {  
               compter ++; 
            }

            if(compter >= longestLength) { //on compare longestLength avec la longueur du 2e mot
               longestLength = compter;
            }

            compter = 0; //on remet le compter à 0

            for (var i = 0 ; i < mot3.length ; i++) {  
               compter ++; 
            }

            if(compter >= longestLength) { //on compare longestLength avec la longueur du 3e mot
               longestLength = compter;
            }

            return longestLength;

         }

         //supprime les doublons dans une chaîne de caractères 
         function removeDoubles(string) {
            var mapping = {};
            var newString = '';

            for (var i = 0; i < string.length; i++) {
                  if (!(string[i] in mapping)) {
                      newString += string[i];
                      mapping[string[i]] = true;
                    }
              }
              return newString;
            }


         form.addEventListener('submit', function(e) {
            e.preventDefault()
            var m1 = document.getElementById('mot1').value;
            var m2 = document.getElementById('mot2').value;
            var m3 = document.getElementById('mot3').value;

            var totalLettres = (m1.concat(m2)).concat(m3); //On concatène les 3 mots en une chaîne de caractères
            var chaine = removeDoubles(totalLettres); // On enlève les doublons (ex : SENDMOREMONEY)
            var longest = getLongestWord(m1,m2,m3);
            
            var retenues = new Array(longest);
      
            let solver = new Solver(); 

         //contraintes générales 
     
         //1
         solver.distinct(chaine); //Toutes les lettres doivent avoir une valeur distincte
         
       
         //2 Chaque lettre est un digit compris entre 0 et 9
         for(var i = 0 ; i < totalLettres.length ; i++) {
            solver.decl(totalLettres.charAt(i), [0,9]); 
         }


        


         //3 M != 0 
         if (m3.length == longest) {
            if (longest > m2.length && longest > m3.length) { //si les 3 mots ne sont pas de longueur égales (m3 plus long que les 2 autres)
               solver.nequ(m3.charAt(0),0); //Première lettre du mot 3 n'est pas zéro (car est = à la retenue)
            }
         }

         //4 Contraintes liant plusieures lettres et leurs retenues
         //On parcourt les mots de la droite vers la gauche (sens de résolution d'une addition classique) et on définit les relations
         //entre les lettres (digits) et leur retenue. 
         //    SEND
         //+   MORE
         //=  MONEY
         //L'ensemble des contraintes obtenues à chaque itération forment des propagateurs qui réduisent l'espace de solutions
         for (var i = longest - 1 ; i>=0 ; i --) {
                  solver.plus(m1.charAt(i), m2.charAt(i), m3.charAt(i)); //m1.charAt(i) + m2.charAt(i) = m3.charAt(i) (ex : D + E = Y)
            
                  //+ gérer les retenues
               }
  

         //On affiche les digit correspondants à chaque lettre 
         for (var i = 0; i< totalLettres.length; i ++) {
            //on appelle la méthode solve() du solveur pour résoudre le puzzle
            solver.solve();
            console.log(solver.solutions);
         }
      })

      window.solve = solve;
       </script>

</body>

</html>